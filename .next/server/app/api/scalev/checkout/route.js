"use strict";(()=>{var e={};e.id=421,e.ids=[421],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6193:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>A,patchFetch:()=>E,requestAsyncStorage:()=>v,routeModule:()=>m,serverHooks:()=>S,staticGenerationAsyncStorage:()=>h});var r={};s.r(r),s.d(r,{POST:()=>d});var n=s(9303),o=s(8716),a=s(670),i=s(7070);let u=process.env.SCALEV_API_BASE,c=process.env.SCALEV_STORE_UNIQUE_ID,l=process.env.SCALEV_API_KEY,p=process.env.SCALEV_PAYMENT_METHOD??"invoice",_="https://app.scalev.id/order/public";async function d(e){let t;let s=[u?null:"SCALEV_API_BASE",l?null:"SCALEV_API_KEY",c?null:"SCALEV_STORE_UNIQUE_ID",p?null:"SCALEV_PAYMENT_METHOD",_?null:"NEXT_PUBLIC_SCALEV_PUBLIC_ORDER_BASE"].filter(Boolean);if(s.length>0)return console.warn("Missing Scalev server configuration keys:",s.join(", ")),i.NextResponse.json({ok:!1,error:"Missing Scalev server configuration",missing:s},{status:500});let r=await e.text();try{t=r?JSON.parse(r):{}}catch{return i.NextResponse.json({ok:!1,error:"Invalid JSON payload"},{status:400})}if(!t.customer_name||!t.customer_phone||!t.customer_email)return i.NextResponse.json({ok:!1,error:"Missing customer fields"},{status:400});if(!t.items||!Array.isArray(t.items)||0===t.items.length)return i.NextResponse.json({ok:!1,error:"Missing order items"},{status:400});if(t.items.find(e=>!e||"string"!=typeof e.variant_unique_id||0===e.variant_unique_id.trim().length||"number"!=typeof e.quantity||e.quantity<=0))return i.NextResponse.json({ok:!1,error:"Invalid order item"},{status:400});let n=t.items.map(e=>({quantity:e.quantity,variant_unique_id:e.variant_unique_id})),o={store_unique_id:c,customer_name:t.customer_name,customer_phone:t.customer_phone,customer_email:t.customer_email,ordervariants:n,payment_method:p},a=await fetch(`${u.replace(/\/$/,"")}/order`,{method:"POST",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify(o)}),d=await a.text(),m=null;try{m=d?JSON.parse(d):null}catch{console.warn("Scalev checkout returned non-JSON response text:",d),m=null}if(!a.ok)return console.warn("Scalev checkout failed with status:",a.status),i.NextResponse.json({ok:!1,error:"Scalev order failed",status:a.status,details:m??d},{status:502});let v=m?.secret_slug??m?.data?.secret_slug;if(!v)return i.NextResponse.json({ok:!1,error:"Scalev response missing secret_slug",details:m??d},{status:502});let h=_.replace(/\/$/,""),S=`${h}/${v}/success`;return i.NextResponse.json({ok:!0,secret_slug:v,redirectUrl:S})}let m=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/scalev/checkout/route",pathname:"/api/scalev/checkout",filename:"route",bundlePath:"app/api/scalev/checkout/route"},resolvedPagePath:"/workspaces/pixelDew/app/api/scalev/checkout/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:v,staticGenerationAsyncStorage:h,serverHooks:S}=m,A="/api/scalev/checkout/route";function E(){return(0,a.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:h})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[948,972],()=>s(6193));module.exports=r})();